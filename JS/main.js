var music_scale;
var ToneBPM = 180;
var BPNConvertMSEC = 60 / ToneBPM * 1000;
Tone.Transport.bpm.value = ToneBPM;
console.log(BPNConvertMSEC);

var count = 0;
/*
var melody_length_ary1 = [
    0.182291666666667,0.172916666666667,0.195833333333333,0.189583333333333,0.2,0.161979166666667,0.172916666666667,0.190104166666667,0.352083333333333,0.182291666666667,0.1609375,0.208854166666667,0.31875,0.1859375,0.190104166666667,0.189583333333333,
    0.347395833333333,0.141666666666667,0.175,0.178645833333333,0.179166666666667,0.184375,0.180729166666667,0.182291666666667,0.172916666666667,0.1953125,0.344791666666667,0.1671875,0.172916666666667,0.191666666666667,0.328645833333333,0.184375,
    0.165625,0.179166666666667,0.578645833333333,0.1453125,0.178645833333333,0.188541666666667,0.168229166666667,0.197395833333333,0.178645833333333,0.169270833333333,0.1859375,0.3453125,0.190104166666667,0.160416666666667,0.1953125,0.335416666666667,
    0.178645833333333,0.202083333333333,0.189583333333333,0.335416666666667,0.138541666666667,0.172916666666667,0.178645833333333,0.175,0.2015625,0.2203125,0.183333333333333,0.161979166666667,0.202604166666667,0.3375,0.15625,0.168229166666667,
    0.184895833333333,0.321354166666667,0.190625,0.178645833333333,0.178645833333333,0.4140625,0.205729166666667,0.201041666666667,0.195833333333333,0.375,0.171875,0.199479166666667,0.188020833333333,0.352083333333333,0.172916666666667,0.207291666666667,
    0.2125,0.324479166666667,0.189583333333333,0.211979166666667,0.21875,0.36875,0.0744791666666667,0.1515625,0.279166666666667,0.100520833333333,0.1625,0.279166666666667,0.2015625,0.1609375,0.245833333333333,0.1953125,
    0.178645833333333,0.1625,0.168229166666667,0.190625,0.179166666666667,0.172916666666667,0.1859375,0.211979166666667,0.160416666666667,0.161979166666667,0.205729166666667,0.31875,0.172916666666667,0.178645833333333,0.1828125,0.341145833333333,
    0.184895833333333,0.190625,0.2015625,0.314583333333333,0.1359375,0.172916666666667,0.168229166666667,0.178645833333333,0.178645833333333,0.199479166666667,0.1828125,0.179166666666667,0.184375,0.334375,0.1953125,0.160416666666667,
    0.191666666666667,0.3390625,0.1671875,0.179166666666667,0.229166666666667,2.03802083333333,2.025
];
var melody_time_ary1 = [
    3330,3663,3996,4329,4662,4995,5328,5661,5994,6993,7326,7659,7992,8991,9324,9657,
    9990,10989,11322,11655,11988,12321,12654,12987,13320,13653,13986,14985,15318,15651,15984,16983,
    17316,17649,17982,19314,19647,19980,20313,20646,20979,21312,21645,21978,22977,23310,23643,23976,
    24975,25308,25641,25974,26973,27306,27639,27972,28305,28638,28971,29304,29637,29970,30969,31302,
    31635,31968,32967,33300,33633,33966,34965,35298,35631,35964,36963,37296,37629,37962,38961,39294,
    39627,39960,40959,41292,41625,41958,42624,42957,43290,43956,44289,44622,44955,45288,45621,45954,
    46287,46620,46953,47286,47619,47952,48285,48618,48951,49284,49617,49950,50949,51282,51615,51948,
    52947,53280,53613,53946,54945,55278,55611,55944,56277,56610,56943,57276,57609,57942,58941,59274,
    59607,59940,60939,61272,61605,61938,61938
];
var melody_data1 = [
    'E5','D#5','E5','D#5','E5','B4','D5','C5','A4','C4','E4','A4','B4','E4','G#4','B4',
    'C5','E4','E5','D#5','E5','D#5','E5','B4','D5','C5','A4','C4','E4','A4','B4','E4',
    'C5','B4','A4','E5','D#5','E5','D#5','E5','B4','D5','C5','A4','C4','E4','A4','B4',
    'E4','G#4','B4','C5','E4','E5','D#5','E5','D#5','E5','B4','D5','C5','A4','C4','E4',
    'A4','B4','E4','C5','B4','A4','B4','C5','D5','E5','G4','F5','E5','D5','F4','E5',
    'D5','C5','E4','D5','C5','B4','E4','E4','E5','E5','E5','E6','D#5','E5','D#5','E5',
    'D#5','E5','D#5','E5','D#5','E5','D#5','E5','B4','D5','C5','A4','C4','E4','A4','B4',
    'E4','G#4','B4','C5','E4','E5','D#5','E5','D#5','E5','B4','D5','C5','A4','C4','E4',
    'A4','B4','D4','C5','B4','A4','C4'
];
var melody_length_ary2 = [
    0.369791666666667,0.643229166666667,0.370833333333333,0.669791666666667,0.341145833333333,0.659895833333333,0.328645833333333,0.6640625,0.353125,0.667708333333333,0.656770833333333,0.385416666666667,0.659895833333333,0.375,0.671875,0.335416666666667,
    0.660416666666667,0.3359375,0.665625,0.352083333333333,0.688020833333333,0.698958333333333,0.172916666666667,0.717708333333333,0.175,0.772395833333333,0.177083333333333,0.689583333333333,1.034375,1.07291666666667,0.351041666666667,0.653125,
    0.367708333333333,0.665625,0.3296875,0.647395833333333,0.3453125,0.666145833333333,0.36875,0.408333333333333,2.03802083333333,2.025
];
var melody_time_ary2 = [
    5999,6666,7998,8665,9997,10664,13994,14661,
    15993,16660,17992,21989,22656,23988,24655,25987,
    26654,29984,30651,31983,32650,33982,36314,36647,
    38312,38645,40310,40643,41975,41975,49969,50636,
    51968,52635,53967,54634,57964,58631,59963,60630,
    61962,61962
];
var melody_data2 = [
    'A3','E3','G#3','E3','A3','E3','A3','E3','G#3','E3','A3','A3','E3','G#3','E3','A3',
    'E3','A3','E3','G#3','E3','A3','G3','C4','G3','B3','A3','C4','E3','G#3','A3','E3',
    'G#3','E3','A3','E3','A3','E3','G#3','E3','A2','E3'
];
*/
//channel:1
//inst:0
var melody_volume_ary10 = [
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100
    ];
    //channel:1
    //inst:0
    var melody_length_ary1 = [
    0.0869791666666667,0.0869791666666667,0.433333333333333,0.0869791666666667,0.0869791666666667,0.433333333333333,0.0869791666666667,0.0869791666666667,0.259895833333333,0.0869791666666667,0.0864583333333333,0.0869791666666667,0.0864583333333333,0.0869791666666667,0.0864583333333333,0.0864583333333333,
    0.0864583333333333,0.0869791666666667,0.0864583333333333,0.0869791666666667,0.0864583333333333,0.0869791666666667,0.172916666666667,0.1734375,0.0864583333333333,0.0869791666666667,0.0864583333333333,0.0869791666666667,0.346875,0.346875,0.0864583333333333,0.0864583333333333,
    0.0864583333333333,0.259895833333333,0.259895833333333,0.259895833333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.172916666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.259895833333333,0.259895833333333,0.259895833333333,0.0869791666666667,0.0869791666666667,
    0.0864583333333333,0.0869791666666667,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.259895833333333,0.259895833333333,0.259895833333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.172916666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,
    0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.69375,0.69375,0.69375,0.69375,
    0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0864583333333333,
    0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.1734375,
    0.1734375,0.1734375,0.1734375,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,
    0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.1734375,0.1734375,0.0864583333333333,0.0864583333333333,0.173958333333333,0.173958333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,
    0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,
    0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0869791666666667,
    0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,
    0.0869791666666667,0.0864583333333333,0.1734375,0.1734375,0.1734375,0.1734375,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0864583333333333,
    0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.1734375,0.1734375,0.0864583333333333,0.0864583333333333,
    0.173958333333333,0.173958333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,
    0.1734375,0.1734375,0.0869791666666667,0.172916666666667,0.0869791666666667,0.1734375,0.1734375,0.1734375,0.346875,0.1734375,0.0869791666666667,0.172916666666667,0.607291666666667,0.1734375,0.1734375,0.1734375,
    0.0869791666666667,0.172916666666667,0.0869791666666667,0.1734375,0.1734375,0.1734375,0.346875,0.346875,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.606770833333333,0.1734375,0.1734375,0.0869791666666667,0.172916666666667,
    0.0869791666666667,0.1734375,0.1734375,0.1734375,0.346875,0.1734375,0.0869791666666667,0.0869791666666667,0.172916666666667,0.172916666666667,0.260416666666667,0.260416666666667,0.1734375,0.1734375,0.0864583333333333,0.0869791666666667,
    0.0864583333333333,0.0869791666666667,0.0864583333333333,0.0869791666666667,0.0864583333333333,0.0869791666666667,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.433333333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,
    0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,
    0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.259895833333333,0.259895833333333,0.259895833333333,0.263541666666667,0.259895833333333,0.259895833333333,0.0869791666666667,0.0869791666666667,
    0.259895833333333,0.259895833333333,0.259895833333333,0.259895833333333,0.259895833333333,0.259895833333333,0.0869791666666667,0.0869791666666667,0.259895833333333,0.259895833333333,0.259895833333333,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,
    0.1734375,0.1734375,0.1734375,0.1734375,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.173958333333333,0.173958333333333,0.173958333333333,0.259895833333333,0.259895833333333,0.259895833333333,0.0864583333333333,0.1734375,0.1734375,
    0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.0864583333333333,0.173958333333333,0.259895833333333,0.1734375,0.1734375,0.1734375,
    0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.173958333333333,0.172916666666667,0.0869791666666667,0.0869791666666667,0.259895833333333,0.259895833333333,0.259895833333333,
    0.263541666666667,0.259895833333333,0.259895833333333,0.0869791666666667,0.0869791666666667,0.259895833333333,0.259895833333333,0.259895833333333,0.259895833333333,0.259895833333333,0.259895833333333,0.0869791666666667,0.0869791666666667,0.259895833333333,0.259895833333333,0.259895833333333,
    0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.173958333333333,0.173958333333333,0.173958333333333,0.259895833333333,
    0.259895833333333,0.259895833333333,0.0864583333333333,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.0864583333333333,
    0.173958333333333,0.259895833333333,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.346875,0.346875,0.346875,0.346875,
    0.259895833333333,0.259895833333333,0.259895833333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.172916666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,
    0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,
    0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.259895833333333,0.259895833333333,0.259895833333333,0.263541666666667,
    0.259895833333333,0.259895833333333,0.0869791666666667,0.0869791666666667,0.259895833333333,0.259895833333333,0.259895833333333,0.259895833333333,0.259895833333333,0.259895833333333,0.0869791666666667,0.0869791666666667,0.259895833333333,0.259895833333333,0.259895833333333,0.1734375,
    0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.173958333333333,0.173958333333333,0.173958333333333,0.259895833333333,0.259895833333333,
    0.259895833333333,0.0864583333333333,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.0864583333333333,0.173958333333333,
    0.259895833333333,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.173958333333333,0.172916666666667,0.0869791666666667,
    0.0869791666666667,0.259895833333333,0.259895833333333,0.259895833333333,0.263541666666667,0.259895833333333,0.259895833333333,0.0869791666666667,0.0869791666666667,0.259895833333333,0.259895833333333,0.259895833333333,0.259895833333333,0.259895833333333,0.259895833333333,0.0869791666666667,
    0.0869791666666667,0.259895833333333,0.259895833333333,0.259895833333333,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.0864583333333333,0.0864583333333333,0.0864583333333333,
    0.173958333333333,0.173958333333333,0.173958333333333,0.259895833333333,0.259895833333333,0.259895833333333,0.0864583333333333,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,
    0.1734375,0.1734375,0.1734375,0.0864583333333333,0.173958333333333,0.259895833333333,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,0.1734375,
    0.346875,0.346875,0.346875,0.346875,0.69375,0.69375,0.69375,0.69375,0.69375,0.69375,0.0864583333333333,0.0864583333333333
    ];
    var melody_time_ary1 = [
    832,999,1166,2164,2331,2498,3496,3663,3830,4329,4662,4995,5328,5494,5828,6494,
    6660,6993,7326,7659,7992,8158,8492,8991,9324,9657,9990,10323,10656,11322,11988,11988,
    11988,12321,12321,12321,12820,12987,13154,13820,14152,14319,14486,14985,14985,14985,15484,15651,
    15818,16150,16484,16816,16983,17150,17649,17649,17649,18148,18315,18482,19148,19480,19647,19814,
    19980,19980,19980,20146,20146,20146,20480,20480,20480,20646,20646,20646,20979,20979,20979,20979,
    22810,22810,23144,23144,23310,23310,23643,23810,24142,24142,24476,24476,24642,24642,24975,25142,
    25474,25474,25641,25641,25808,25808,25974,25974,26307,26474,26640,26640,26806,26973,27140,27306,
    27306,27639,27639,28138,28138,28472,28472,28638,28638,28971,29138,29470,29470,29637,29637,29804,
    29804,29970,29970,30303,30470,30636,30636,30969,30969,31302,31302,31468,31468,31802,32134,32134,
    32134,32301,32301,32301,32468,32468,32468,32634,32634,32634,32967,33466,33466,33633,33633,33800,
    33800,33966,33966,34299,34466,34798,34798,34965,34965,35132,35132,35298,35298,35464,35464,35631,
    35798,36130,36130,36297,36297,36464,36464,36630,36630,36796,36796,36963,37130,37296,37296,37462,
    37629,37796,37962,37962,38295,38295,38794,38794,38961,38961,39128,39128,39294,39294,39627,39794,
    40126,40126,40293,40293,40460,40460,40626,40626,40959,41126,41292,41292,41625,41625,41958,41958,
    42124,42124,42458,42790,42790,42790,42957,42957,42957,43124,43124,43124,43290,43290,43290,43623,
    44289,44622,44955,45122,45454,45621,45954,46287,46620,47286,47619,47786,48118,49617,49617,49950,
    50283,50450,50782,50949,51282,51615,51948,51948,52614,52780,52947,53114,54945,55278,55611,55778,
    56110,56277,56610,56943,57276,57942,58275,58275,58442,58442,58774,58774,59274,59607,59940,60273,
    60606,60939,61272,61605,61938,62271,62604,62770,62937,63104,64602,64768,64935,65102,65268,65268,
    65268,65434,65434,65434,66267,66267,66267,66434,66434,66434,66766,66766,66766,66933,66933,66933,
    67100,67100,67100,67266,67266,67266,67432,67599,67766,67766,67766,68265,68265,68265,68764,68931,
    69098,69098,69098,69597,69597,69597,70096,70263,70430,70430,70430,70929,70929,70929,71262,71262,
    71262,71595,71595,71595,71928,71928,71928,72094,72094,72094,72428,72428,72428,73094,73260,73260,
    73260,73593,73593,73593,73926,73926,73926,74259,74259,74259,74592,74758,75092,75591,75924,75924,
    75924,76257,76257,76257,76590,76590,76923,77090,77256,77422,77756,78088,78255,78422,78422,78422,
    78921,78921,78921,79420,79587,79754,79754,79754,80253,80253,80253,80752,80919,81086,81086,81086,
    81585,81585,81585,81918,81918,81918,82251,82251,82251,82584,82584,82584,82750,82750,82750,83084,
    83084,83084,83750,83916,83916,83916,84249,84249,84249,84582,84582,84582,84915,84915,84915,85248,
    85414,85748,86247,86580,86580,86580,86913,86913,86913,87246,87246,87579,87912,87912,88578,88578,
    89577,89577,89577,90076,90243,90410,91076,91408,91575,91742,91908,91908,91908,91908,92074,92074,
    92074,92074,92907,92907,92907,92907,93074,93074,93074,93074,93406,93406,93406,93406,93573,93573,
    93573,93573,93740,93740,93740,93740,93906,93906,93906,93906,94072,94239,94406,94406,94406,94905,
    94905,94905,95404,95571,95738,95738,95738,96237,96237,96237,96736,96903,97070,97070,97070,97569,
    97569,97569,97902,97902,97902,98235,98235,98235,98568,98568,98568,98734,98734,98734,99068,99068,
    99068,99734,99900,99900,99900,100233,100233,100233,100566,100566,100566,100899,100899,100899,101232,101398,
    101732,102231,102564,102564,102564,102897,102897,102897,103230,103230,103563,103730,103896,104062,104396,104728,
    104895,105062,105062,105062,105561,105561,105561,106060,106227,106394,106394,106394,106893,106893,106893,107392,
    107559,107726,107726,107726,108225,108225,108225,108558,108558,108558,108891,108891,108891,109224,109224,109224,
    109390,109390,109390,109724,109724,109724,110390,110556,110556,110556,110889,110889,110889,111222,111222,111222,
    111555,111555,111555,111888,112054,112388,112887,113220,113220,113220,113553,113553,113553,113886,113886,114219,
    114552,114552,115218,115218,115884,115884,115884,117216,117216,117216,118548,118548
    ];
    var melody_data1 = [
    'B3','C#4','E4','B3','C#4','F#4','B3','C#4','G#4','G#4','A4','B4','B4','A4','A4','F#4',
    'B4','A4','B4','A4','G#4','B4','E4','G#4','A4','G#4','E4','C#4','D#4','F#4','E4','B3',
    'G#3','E5','G#4','B4','B4','C#5','E5','G#5','E5','F#5','E5','E5','G#4','B4','B4','C#5',
    'E5','B5','A5','F#5','G#5','E5','E5','B4','G#4','B4','C#5','E5','G#5','E5','F#5','E5',
    'G5','C5','E5','G5','E5','C5','A5','D5','F#5','A5','F#5','D5','B5','B4','D#5','F#5',
    'B3','G#4','B3','G#4','B3','G#4','F#4','E4','G#3','E4','G#3','E4','G#3','E4','F#4','G#4',
    'A3','C#4','A3','C#4','A3','C#4','A3','C#4','D#4','E4','F#4','D#4','G#4','F#4','E4','G#4',
    'D#4','F#4','D#4','G#4','B3','G#4','B3','G#4','B3','F#4','E4','E4','G#3','E4','G#3','E4',
    'G#3','E4','G#3','F#4','G#4','A4','C#4','A4','C#4','G#4','D#4','F#4','D#4','F#4','E4','B3',
    'G#3','E4','B3','G#3','E4','B3','G#3','E4','B3','G#3','B5','B3','G#4','G#4','B3','B3',
    'G#4','B3','G#4','F#4','E4','G#3','E4','E4','G#3','G#3','E4','G#3','E4','E4','G#3','F#4',
    'G#4','A3','C#4','A3','C#4','A3','C#4','A3','C#4','C#4','A3','D#4','E4','F#4','D#4','G#4',
    'F#4','E4','G#4','D#4','F#4','D#4','G#4','B3','G#4','B3','G#4','B3','G#4','B3','F#4','E4',
    'E4','G#3','E4','G#3','E4','G#3','E4','G#3','F#4','G#4','A4','C#4','A4','C#4','G#4','D#4',
    'F#4','D#4','F#4','E4','B3','G#3','E4','B3','G#3','E4','B3','G#3','E4','B3','G#3','E6',
    'E4','D#4','E4','F#4','F#4','E4','D#4','C#4','B3','B3','F#4','F#4','E4','C#4','A3','D#4',
    'E4','F#4','F#4','E4','E4','F#4','G#4','D#4','G#4','E4','C#5','B4','E4','D#4','E4','F#4',
    'F#4','E4','D#4','C#4','B3','B3','F#4','B3','F#4','C#4','F4','C#4','F#4','G#4','A4','G#4',
    'F#4','E4','E4','C#4','E4','G#4','G#4','F#4','E4','F#4','G#4','F#4','G#4','F#4','B4','D#4',
    'F#4','B4','D#4','F#4','B4','D#4','F#4','B4','D#4','F#4','B4','D#4','F#4','B4','F#4','D#4',
    'B4','F#4','D#4','B4','F#4','D#4','B3','C#4','E4','B3','G#3','B4','E5','G#4','B3','C#4',
    'D#4','F#4','B3','B4','F#5','D#5','B3','C#4','G#4','B3','D4','G#4','B3','D4','A4','B3',
    'D4','B4','B3','D4','B4','C#4','E4','A4','C#4','E4','A4','C#4','E4','F#4','B4','C#4',
    'E4','A4','E4','C#4','B4','E4','C#4','A4','E4','C#4','G#4','B4','E4','G#4','A4','C#4',
    'E4','G#4','E4','C#4','E4','C#4','C#4','C#4','D#4','E4','F#4','B3','C#4','E4','B3','G#3',
    'B4','E5','G#4','B3','C#4','D#4','F#4','B3','B4','F#5','D#5','B3','C#4','G#4','B3','D4',
    'G#4','B3','D4','A4','B3','D4','B4','B3','D4','B4','C#4','E4','A4','C#4','E4','A4',
    'C#4','E4','F#4','B4','C#4','E4','A4','E4','C#4','B4','E4','C#4','A4','E4','C#4','G#4',
    'B4','E4','G#4','A4','C#4','E4','G#4','E4','C#4','C#4','E4','C#4','D#4','B3','F#4','B3',
    'E5','B4','G#4','B4','C#5','E5','G#5','E5','F#5','E5','C5','E5','G5','C6','C5','E5',
    'G5','C6','C5','E5','G5','C6','C5','E5','G5','C6','C5','E5','G5','C6','C5','E5',
    'G5','C6','C5','E5','G5','C6','C5','E5','G5','C6','C4','D4','F4','C4','A3','C5',
    'F5','A4','C4','D4','E4','G4','C4','C5','G5','E5','C4','D4','A4','C4','D#4','A4',
    'C4','D#4','A#4','C4','D#4','C5','C4','D#4','C5','D4','F4','A#4','D4','F4','A#4','D4',
    'F4','G4','C5','D4','F4','A#4','F4','D4','C5','F4','D4','A#4','F4','D4','A4','C5',
    'F4','A4','A#4','D4','F4','A4','F4','D4','F4','D4','D4','D4','E4','F4','G4','C4',
    'D4','F4','C4','A3','C5','F5','A4','C4','D4','E4','G4','C4','C5','G5','E5','C4',
    'D4','A4','C4','D#4','A4','C4','D#4','A#4','C4','D#4','C5','C4','D#4','C5','D4','F4',
    'A#4','D4','F4','A#4','D4','F4','G4','C5','D4','F4','A#4','F4','D4','C5','F4','D4',
    'A#4','F4','D4','A4','C5','F4','A4','A#4','D4','F4','A4','F4','D4','D4','F4','D4',
    'E4','C4','G4','C4','F4','A3','C4','C6','F5','C5','F4','A3'
    ];
    var melody_volume_ary1 = [
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100
    ];
    //channel:2
    //inst:0
    var melody_length_ary2 = [
    0.69375,0.69375,0.69375,0.69375,0.69375,0.69375,0.69375,0.69375,0.69375,0.69375,0.69375,0.69375,0.69375,0.69375,0.69375,0.260416666666667,
    0.260416666666667,0.260416666666667,0.433333333333333,0.433333333333333,0.433333333333333,0.69375,0.69375,0.69375,0.69375,0.69375,0.69375,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,
    0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,
    0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,
    0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,
    0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.172916666666667,0.172916666666667,0.172916666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,
    0.0864583333333333,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,
    0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,
    0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,
    0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,
    0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,
    0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,
    0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,
    0.1734375,0.1734375,0.0864583333333333,0.0864583333333333,0.260416666666667,0.260416666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.260416666666667,0.0864583333333333,
    0.260416666666667,0.0864583333333333,0.260416666666667,0.0864583333333333,0.260416666666667,0.0864583333333333,0.260416666666667,0.0864583333333333,0.260416666666667,0.0864583333333333,0.260416666666667,0.0864583333333333,0.260416666666667,0.0864583333333333,0.260416666666667,0.0864583333333333,
    0.260416666666667,0.0864583333333333,0.260416666666667,0.0864583333333333,0.260416666666667,0.0864583333333333,0.260416666666667,0.0864583333333333,0.260416666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,
    0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,
    0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,
    0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,
    0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0869791666666667,
    0.0869791666666667,0.0869791666666667,0.0869791666666667,0.172916666666667,0.172916666666667,0.172916666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.1734375,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,
    0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0869791666666667,
    0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,
    0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,
    0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,
    0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,
    0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,
    0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,
    0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,
    0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,
    0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,
    0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.173958333333333,0.173958333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.172916666666667,
    0.172916666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,
    0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,
    0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,
    0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,
    0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,
    0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,
    0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,
    0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,
    0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.0864583333333333,0.0869791666666667,0.0869791666666667,0.0864583333333333,0.69375,0.69375,0.0864583333333333,0.0864583333333333
    ];
    var melody_time_ary2 = [
    1332,1332,1332,2664,2664,2664,3996,3996,3996,5328,5328,5328,6660,6660,6660,7992,
    7992,7992,8492,8492,8492,9324,9324,9324,10656,10656,10656,11988,12154,12321,12488,12654,
    12820,12987,13154,13320,13486,13653,13820,13986,14152,14319,14486,14652,14818,14985,15152,15318,
    15484,15651,15818,15984,16150,16317,16484,16650,16816,16983,17150,17316,17482,17649,17816,17982,
    18148,18315,18482,18648,18814,18981,19148,19314,19480,19647,19814,19980,19980,19980,20146,20146,
    20146,20480,20480,20480,20646,20646,20646,20979,20979,20979,21146,21146,21146,21478,21645,21812,
    21978,22311,22644,22644,22810,22810,23976,23976,24142,24142,25308,25308,25474,25474,26640,26640,
    26806,26806,27306,27306,27472,27472,27972,27972,28138,28138,29304,29304,29470,29470,30636,30636,
    30802,30802,31302,31302,31468,31468,32134,32134,32301,32301,32468,32468,32634,32634,33300,33300,
    33466,33466,33633,33633,33800,33800,33966,33966,34132,34132,34299,34299,34466,34466,34632,34798,
    34965,35132,35298,35464,35631,35798,35964,36130,36297,36464,36630,36796,36963,37130,37296,37462,
    37629,37796,37962,38128,38295,38462,38628,38628,38794,38794,38961,38961,39128,39128,39294,39294,
    39460,39460,39627,39627,39794,39794,39960,40126,40293,40460,40626,40792,40959,41126,41292,41292,
    41625,41625,41958,41958,42124,42124,42790,42790,42957,42957,43124,43124,43290,43290,43956,44456,
    44622,45122,45288,45788,45954,46454,46620,47120,47286,47786,47952,48452,48618,49118,49284,49784,
    49950,50450,50616,51116,51282,51782,51948,52448,52614,53114,53280,53446,53613,53780,53946,54112,
    54279,54446,54612,54778,54945,55112,55278,55444,55611,55778,55944,56110,56277,56444,56610,56776,
    56943,57110,57276,57442,57609,57776,57942,58108,58275,58442,58608,58774,58941,59108,59274,59440,
    59607,59774,59940,59940,59940,60273,60273,60273,60606,60606,60606,60939,60939,60939,61272,61272,
    61272,61605,61605,61605,61938,61938,61938,62271,62271,62271,62604,62604,62604,62770,62770,62770,
    62937,62937,62937,63104,63104,63104,63436,63603,63770,63936,64269,64436,64602,65268,65268,65268,
    65434,65434,65434,65768,65768,65934,65934,66267,66267,66267,66434,66434,66434,66766,66766,66933,
    66933,67100,67100,67266,67266,67932,68098,68265,68432,68598,68764,68931,69098,69264,69430,69597,
    69764,69930,70096,70263,70430,70596,70762,70929,71096,71262,71428,71595,71762,71928,72094,72261,
    72428,72594,72760,72927,73094,73260,73426,73593,73760,73926,74092,74259,74426,74592,74758,74925,
    75092,75258,75424,75591,75758,75924,76090,76257,76424,76590,76756,76923,77090,77256,77422,77589,
    77756,77922,78088,78255,78422,78588,78754,78921,79088,79254,79420,79587,79754,79920,80086,80253,
    80420,80586,80752,80919,81086,81252,81418,81585,81752,81918,82084,82251,82418,82584,82750,82917,
    83084,83250,83416,83583,83750,83916,84082,84249,84416,84582,84748,84915,85082,85248,85414,85581,
    85748,85914,86080,86247,86414,86580,86746,86913,87080,87246,87412,87579,87746,87912,88078,88245,
    88412,88578,88744,88911,89078,89244,89410,89577,89744,89910,90076,90243,90410,90576,90742,90909,
    91076,91242,91408,91575,91742,91908,91908,92074,92074,92408,92408,92574,92574,92907,92907,93074,
    93074,93406,93406,93573,93573,93740,93740,93906,93906,94572,94738,94905,95072,95238,95404,95571,
    95738,95904,96070,96237,96404,96570,96736,96903,97070,97236,97402,97569,97736,97902,98068,98235,
    98402,98568,98734,98901,99068,99234,99400,99567,99734,99900,100066,100233,100400,100566,100732,100899,
    101066,101232,101398,101565,101732,101898,102064,102231,102398,102564,102730,102897,103064,103230,103396,103563,
    103730,103896,104062,104229,104396,104562,104728,104895,105062,105228,105394,105561,105728,105894,106060,106227,
    106394,106560,106726,106893,107060,107226,107392,107559,107726,107892,108058,108225,108392,108558,108724,108891,
    109058,109224,109390,109557,109724,109890,110056,110223,110390,110556,110722,110889,111056,111222,111388,111555,
    111722,111888,112054,112221,112388,112554,112720,112887,113054,113220,113386,113553,113720,113886,114052,114219,
    114386,114552,114718,114885,115052,115218,115384,115551,115718,115884,115884,118548,118548
    ];
    var melody_data2 = [
    'E3','G#3','B3','D#3','G#3','B3','D3','B3','G#3','C#3','E3','A3','A3','C#4','E4','G#3',
    'B3','D#4','C#3','E3','G#3','F#3','C#3','F#2','B2','F#3','B3','E2','E3','E2','E3','E2',
    'E3','E2','E3','A2','A3','A2','A3','B2','B3','B2','B3','E2','E3','E2','E3','E2',
    'E3','E2','E3','A2','A3','A2','A3','B2','B3','B2','B3','E2','E3','E2','E3','E2',
    'E3','E2','E3','A2','A3','A2','A3','B2','B3','B2','B3','C4','C3','G3','C4','C3',
    'G3','D4','D3','A3','D4','D3','A3','B3','B2','F#3','B3','B2','F#3','B2','B2','B2',
    'B2','B2','E3','E2','E3','E2','C#3','C#2','C#3','C#2','A3','A2','A3','A2','B3','B2',
    'B3','B2','B3','B2','B3','B2','E3','E2','E3','E2','C#3','C#2','C#3','C#2','A3','A2',
    'A3','A2','B3','B2','B3','B2','E3','E2','E3','E2','E3','E2','E3','E2','E2','E2',
    'E3','E3','E2','E2','E3','E3','E2','E2','E3','E3','E2','E2','E3','E3','C#2','C#3',
    'C#2','C#3','C#2','C#3','C#2','C#3','A2','A3','A2','A3','A2','A3','A2','A3','B2','B3',
    'B2','B3','B2','B3','B2','B3','E2','E2','E3','E3','E2','E2','E3','E3','E2','E2',
    'E3','E3','E2','E2','E3','E3','C#2','C#3','C#2','C#3','C#2','C#3','C#2','C#3','A2','A3',
    'A2','A3','B2','B3','B2','B3','E3','E2','E3','E2','E3','E2','E3','E2','A2','E3',
    'A3','E3','B2','F#3','B3','F#3','G#2','D#3','G#3','D#3','C#3','G#3','C#4','G#3','A2','E3',
    'A3','E3','B2','F#3','B3','F#3','G#2','D#3','G#3','D#3','C#3','G#3','C#4','G#3','B2','F#3',
    'B3','F#3','A2','A3','A2','A3','A2','A3','A2','A3','B2','B3','B2','B3','B2','B3',
    'B2','B3','G#2','G#3','G#2','G#3','G#2','G#3','G#2','G#3','C#3','C#4','C#3','C#4','C#3','C#4',
    'C#3','C#4','A2','A3','E3','A2','A3','E3','A2','A3','E3','A2','A3','E3','A#2','A#3',
    'F#3','A#2','A#3','F#3','A#2','A#3','F#3','A#2','A#3','F#3','B3','F#3','B2','B3','F#3','B2',
    'B3','F#3','B2','B3','F#3','B2','B2','B2','B2','B2','B2','B2','B2','B3','F#3','B2',
    'B3','F#3','B2','B2','B1','B2','B1','B3','B2','F#3','B3','B2','F#3','B2','B1','B2',
    'B1','B2','B1','B2','B1','E2','E3','E2','E3','E2','E3','E2','E3','D#2','D#3','D#2',
    'D#3','D#2','D#3','D#2','D#3','D2','D3','D2','D3','D2','D3','D2','D3','C#2','C#3','C#2',
    'C#3','C#2','C#3','C#2','C#3','A2','A3','A2','A3','A2','A3','A2','A3','G#2','G#3','G#2',
    'G#3','C#2','C#3','C#2','C#3','F#2','F#3','F#2','F#3','F#2','F#3','F#2','F#3','B2','B3','B2',
    'B3','B2','B3','B2','B3','E2','E3','E2','E3','E2','E3','E2','E3','D#2','D#3','D#2',
    'D#3','D#2','D#3','D#2','D#3','D2','D3','D2','D3','D2','D3','D2','D3','C#2','C#3','C#2',
    'C#3','C#2','C#3','C#2','C#3','A2','A3','A2','A3','A2','A3','A2','A3','G#2','G#3','G#2',
    'G#3','C#2','C#3','C#2','C#3','F#2','F#3','F#2','F#3','F#2','F#3','F#2','F#3','B2','B3','B2',
    'B3','B2','B3','B2','B3','E2','E3','E2','E3','E2','E3','E2','E3','A2','A3','A2',
    'A3','B2','B3','B2','B3','C4','C3','C4','C3','C2','C3','C2','C3','C3','C4','C3',
    'C4','C2','C3','C2','C3','C2','C3','C2','C3','F2','F3','F2','F3','F2','F3','F2',
    'F3','E2','E3','E2','E3','E2','E3','E2','E3','D#2','D#3','D#2','D#3','D#2','D#3','D#2',
    'D#3','D2','D3','D2','D3','D2','D3','D2','D3','A#2','A#3','A#2','A#3','A#2','A#3','A#2',
    'A#3','A2','A3','A2','A3','D2','D3','D2','D3','G2','G3','G2','G3','G2','G3','G2',
    'G3','C3','C4','C3','C4','C3','C4','C3','C4','F2','F3','F2','F3','F2','F3','F2',
    'F3','E2','E3','E2','E3','E2','E3','E2','E3','D#2','D#3','D#2','D#3','D#2','D#3','D#2',
    'D#3','D2','D3','D2','D3','D2','D3','D2','D3','A#2','A#3','A#2','A#3','A#2','A#3','A#2',
    'A#3','A2','A3','A2','A3','D2','D3','D2','D3','G2','G3','G2','G3','G2','G3','G2',
    'G3','C3','C4','C3','C4','C3','C4','C3','C4','F3','F2','F2','C3'
    ];
    var melody_volume_ary2 = [
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,100,
    100,100,100,100,100,100,100,100,100,100,100,100,100
    ];
    
    var timeScale = 1.5;
    for(var i=0; i<melody_time_ary1.length; i++){
        melody_time_ary1[i] = melody_time_ary1[i] * timeScale;
    }
    for(var i=0; i<melody_time_ary2.length; i++){
        melody_time_ary2[i] = melody_time_ary2[i] * timeScale;
    }

var melody_length_ary = melody_length_ary1;
var melody_time_ary = melody_time_ary1;
var melody_data = melody_data1;
var melodyFlagAry = createBrankAry(melody_time_ary);

var countUp = 0;
var atCount = 0;
var startTime = new Date(), atTime = new Date(), diffTime = new Date();

var beforeX = 0, beforeY = 0;
var norm_threshold = -1;
var beforeRange = 100;
var afterRange = 100;

document.addEventListener("DOMContentLoaded", function(){
    var ripple_wood = document.getElementById("ripple_div");
    
    ripple_wood.addEventListener("click", function (event) { 

        var norm = Math.sqrt( Math.pow(event.pageX - beforeX,2) + Math.pow(event.pageY - beforeY, 2));
        //console.log(norm);
        beforeX = event.pageX;
        beforeY = event.pageY;

        var synth = new Tone.Synth().toMaster();
        //synth.volume.value = 1;
        if(count == 0){
            //startAccompaniment(accompaniment_time_ary, accompaniment_data);
           // startAccompaniment(melody_time_ary1, melody_data1, melody_length_ary1, melody_volume_ary1, melodyFlagAry, false);
            startAccompaniment(melody_time_ary1, melody_data1, melody_length_ary1, melody_volume_ary1, melodyFlagAry, true);
            startAccompaniment(melody_time_ary2, melody_data2, melody_length_ary2, melody_volume_ary2, melodyFlagAry, false);
            /*startAccompaniment(melody_time_ary3, melody_data3, melody_length_ary3, melody_volume_ary3, melodyFlagAry, false);
            startAccompaniment(melody_time_ary4, melody_data4, melody_length_ary4, melody_volume_ary4, melodyFlagAry, false);
            startAccompaniment(melody_time_ary5, melody_data5, melody_length_ary5, melody_volume_ary5, melodyFlagAry, false);
            startAccompaniment(melody_time_ary6, melody_data6, melody_length_ary6, melody_volume_ary6, melodyFlagAry, false);
            startAccompaniment(melody_time_ary7, melody_data7, melody_length_ary7, melody_volume_ary7, melodyFlagAry, false);
*/
            Tone.Transport.start();
            startTime = new Date();
            atTime = new Date();
            countUp = 0;
            atCount = 0;
        }else{
            atTime = new Date();
        }
        diffTime = atTime.getTime() - startTime.getTime();
        //console.log(diffTime);
        
        var clickSuccessFlag = false;
        for(var i=atCount; i<melody_time_ary.length; i++){
           // music_scale = melody_data[countUp];
           // console.log(melody_time_ary[i] * BPNConvertMSEC);
            if((melody_time_ary[i] - beforeRange) <= diffTime + melody_time_ary[0] && (melody_time_ary[i] + afterRange) >= diffTime + melody_time_ary[0] ){
                atCount = i;
                clickSuccessFlag = true;
                console.log("Success!" + atCount);
                break;
            }
        }

        var rand = Math.round(Math.random() * melody_data.length);
        
        if(clickSuccessFlag){
            for(var i=atCount; i<atCount+10; i++){
                if(melody_time_ary[atCount] == melody_time_ary[i]){
                    //if(melodyFlagAry[i] == 0){
                        if(norm > norm_threshold){
                            console.log("OK!");
                            music_scale = melody_data[i];
                            melodyFlagAry[i] = 1;
                        }else{
                            music_scale = music_scale;
                            console.log("Same Miss!");
                        }
/*
                   // }else{
                        if(norm > norm_threshold){
                            console.log("Miss1!");
                            music_scale = melody_data[rand];
                        }
                        //music_scale = 0;
                }*/
                    synth.triggerAttackRelease(music_scale, melody_length_ary[i]);
                }
            }
        }else{
            if(norm > norm_threshold){
                console.log("Miss2!");
                music_scale = melody_data[rand];
            }else{
                console.log("Miss3!");
            }
            synth.triggerAttackRelease(music_scale, "8n");
        }
 
        //music_scale = melody_data[countUp];
        countUp++;
        

        if((melody_time_ary[melody_time_ary.length-1]) < diffTime){
            //Tone.Transport.stop();
            console.log("Over!");
            count = 0;
            melodyFlagAry = createBrankAry(melody_time_ary);
        }
        else{
            count++;
        }
    }, false);

}, false);

function waitNote(msec, count, mainFlag, flagAry){
    var objDef = new $.Deferred;
    setTimeout(function(){
        objDef.resolve(count, mainFlag, flagAry);
    }, msec);
    return objDef.promise(count, mainFlag, flagAry);
}

function startAccompaniment(timeAry, dataAry, lengthAry, volumeAry, flagAry, mainFlag){
    var synth = new Tone.Synth().toMaster();
    for(var i=0; i<timeAry.length; i++){
        var nextTime = timeAry[i] - melody_time_ary[0];
        //nextTime = nextTime * 2.5;

        waitNote(nextTime, i, mainFlag, flagAry).done(function(count, mainFlag){
            if(mainFlag){
                if(flagAry[count] == 0){
                    synth.volume.value = -0.1*(255 - volumeAry[count]);
                    synth.volume.value = -40;
                    var scale = dataAry[count];
                    synth.triggerAttackRelease(scale, lengthAry[count]);
                }
            }
            else{
                synth.volume.value = -0.1*(255 - volumeAry[count])/2;
                var scale = dataAry[count];
                synth.triggerAttackRelease(scale, lengthAry[count]); 
            }
        });
    }
}

function createBrankAry(ary){
    var tempAry = {};
    for(var i=0; i<ary.length; i++){
        tempAry[i] = 0;
    }
    return tempAry;
}

